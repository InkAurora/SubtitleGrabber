<!DOCTYPE html>
<html>
  <head>
    <title>OpenSubtitles Grabber</title>
  </head>
  <body>
    <div
      id="OpenSubtitlesGrabberConfigPage"
      data-role="page"
      class="page type-interior pluginConfigurationPage"
      data-require="emby-input,emby-button,emby-select,emby-checkbox"
    >
      <div data-role="content">
        <div class="content-primary">
          <form id="OpenSubtitlesGrabberConfigForm">
            <div class="sectionTitleContainer flex align-items-center">
              <h2 class="sectionTitle">OpenSubtitles Grabber Settings</h2>
            </div>

            <div class="checkboxContainer checkboxContainer-withDescription">
              <label class="emby-checkbox-label">
                <input
                  id="chkEnableDebugLogging"
                  type="checkbox"
                  is="emby-checkbox"
                />
                <span>Enable debug logging</span>
              </label>
              <div class="fieldDescription checkboxFieldDescription">
                Enable detailed logging for troubleshooting subtitle search and
                download issues.
              </div>
            </div>

            <div class="inputContainer">
              <label
                class="inputLabel inputLabelUnfocused"
                for="txtMaxSearchResults"
                >Max Search Results</label
              >
              <input
                id="txtMaxSearchResults"
                name="txtMaxSearchResults"
                type="number"
                is="emby-input"
                min="1"
                max="50"
                step="1"
              />
              <div class="fieldDescription">
                Maximum number of subtitle results to return per search (1-50).
              </div>
            </div>

            <div class="inputContainer">
              <label
                class="inputLabel inputLabelUnfocused"
                for="txtRequestTimeoutSeconds"
                >Request Timeout (seconds)</label
              >
              <input
                id="txtRequestTimeoutSeconds"
                name="txtRequestTimeoutSeconds"
                type="number"
                is="emby-input"
                min="5"
                max="120"
                step="1"
              />
              <div class="fieldDescription">
                Timeout for web requests to OpenSubtitles.org (5-120 seconds).
              </div>
            </div>

            <div>
              <button
                is="emby-button"
                type="submit"
                class="raised button-submit block emby-button"
              >
                <span>Save</span>
              </button>
            </div>
          </form>
        </div>
      </div>

      <script type="text/javascript">
        (function () {
          var pluginId = "A1B2C3D4-E5F6-7890-ABCD-123456789012";

          $("#OpenSubtitlesGrabberConfigPage").on("pageshow", function () {
            Dashboard.showLoadingMsg();
            ApiClient.getPluginConfiguration(pluginId).then(function (config) {
              $("#chkEnableDebugLogging").checked =
                config.EnableDebugLogging || false;
              $("#txtMaxSearchResults").val(config.MaxSearchResults || 10);
              $("#txtRequestTimeoutSeconds").val(
                config.RequestTimeoutSeconds || 30
              );
              Dashboard.hideLoadingMsg();
            });
          });

          $("#OpenSubtitlesGrabberConfigForm").on("submit", function () {
            Dashboard.showLoadingMsg();
            ApiClient.getPluginConfiguration(pluginId).then(function (config) {
              config.EnableDebugLogging = $("#chkEnableDebugLogging").checked;
              config.MaxSearchResults =
                parseInt($("#txtMaxSearchResults").val()) || 10;
              config.RequestTimeoutSeconds =
                parseInt($("#txtRequestTimeoutSeconds").val()) || 30;

              ApiClient.updatePluginConfiguration(pluginId, config).then(
                function (result) {
                  Dashboard.processPluginConfigurationUpdateResult(result);
                }
              );
            });

            return false;
          });
        })();
      </script>
    </div>
  </body>
</html>
